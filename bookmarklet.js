// thanks to http://ted.mielczarek.org/code/mozilla/bookmarklet.html
// use the commented out code below as bookmarklet code (copy/paste it into your address bar on a page)
// javascript:(function(){if(typeof%20jQuery=='undefined'){var%20jQ=document.createElement('script');jQ.type='text/javascript';jQ.onload=bookmarklet;jQ.src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js';document.body.appendChild(jQ);}else{bookmarklet();}function%20bookmarklet(){(function($){var%20global={o:{},e:[],source:{},overlay:null};var%20checkRefresh=function(){if(global.o.source==%22cursor%22){return%20false}$.fn.galleryFocus(global.o)};var%20calculatePosition=function(local){var%20p=local.el.offset();if(p.left==local.pos.left&&p.top==local.pos.top){return%20local.pos}var%20position={left:p.left,top:p.top,width:local.el.outerWidth(),height:local.el.outerHeight()};position.right=Math.floor(p.left+position.width);position.bottom=Math.floor(p.top+position.height);position.x=Math.floor(p.left+(position.width/2));position.y=Math.floor(p.top+(position.height/2));return%20position};var%20setFocus=function(elements){$.each(elements,function(i,el){if(typeof%20elements[i]==%22undefined%22){return%20true}elements[i].pos=calculatePosition(elements[i]);if(!testInBox(el)){if(global.o.invert){setOpacity(el,1)}else{setOpacity(el,global.o.fadeTo)}return%20true}el.pos=elements[i].pos;var%20length=distance(global.source,el.pos);var%20opacity=global.o.fadeTo;if(global.o.invert){opacity=toFloat(percentOf(length,global.o.radius))}else{opacity=toFloat(invertPercent(percentOf(length,global.o.radius)))}if(opacity%3Cglobal.o.fadeTo){opacity=global.o.fadeTo}setOpacity(el,opacity)})};var%20createOverlay=function(){var%20style={position:%22absolute%22,top:0,left:0,width:0,height:0,%22z-index%22:999,%22-moz-border-radius%22:%221000px%22,%22-webkit-border-radius%22:%221000px%22,%22-khtml-border-radius%22:%221000px%22,%22border-radius%22:%221000px%22,border:%222px%20solid%20rgba(80,%2080,%2080,%200.30)%22,%22pointer-events%22:%22none%22};$('%3Cdiv%20id=%22gallery-focus-radius%22%3E').css(style).appendTo(%22body%22);global.overlay=$(%22#gallery-focus-radius%22)};var%20testInBox=function(el){var%20p=el.pos;if(p.left%3Cglobal.source.left||p.top%3Cglobal.source.top||p.right%3Eglobal.source.right||p.bottom%3Eglobal.source.bottom){return%20false}return%20true};var%20percentOf=function(a,b){return%20Math.floor((a/b)*100)};var%20toFloat=function(num){return(num/100)};var%20invertPercent=function(num){return(100-num)};var%20distance=function(p,q){var%20dx=p.x-q.x;var%20dy=p.y-q.y;var%20dist=Math.sqrt(dx*dx+dy*dy);return%20dist};var%20setOpacity=function(element,value){element.opacity=value;element.el.css(%22opacity%22,value)};var%20calculateMouse=function(e){global.source={x:e.pageX,y:e.pageY,left:e.pageX-global.o.radius,top:e.pageY-global.o.radius,right:e.pageX+global.o.radius,bottom:e.pageY+global.o.radius};if(global.o.overlay){if(global.overlay==null){createOverlay()}global.overlay.css({top:global.source.top,left:global.source.left,width:global.o.radius*2,height:global.o.radius*2})}};var%20setupSource=function(){var%20bindTo=$(global.o.source);if($(bindTo).length==1){$(document).unbind(%22.galleryFocus%22);var%20position=calculatePosition({el:bindTo,pos:{top:0,left:0}});calculateMouse({pageX:position.x,pageY:position.y});setFocus(global.e)}else{$(document).bind(%22mousemove.galleryFocus%22,function(c){calculateMouse(c);setFocus(global.e)})}};var%20methods={init:function(options){var%20defaults={radius:400,fadeTo:0.2,source:%22cursor%22,invert:false,overlay:false};global.o=$.extend(defaults,options);this.each(function(i,el){global.e[i]={el:$(el),opacity:1,pos:{}};global.e[i].pos=calculatePosition(global.e[i])});setupSource();return%20this},overlay:function(value){global.o.overlay=value;if(value==false){global.overlay.hide()}else{if(global.overlay==null){calculateMouse(global.source)}checkRefresh();global.overlay.show()}},update:function(value){$.fn.galleryFocus(global.o)},source:function(value){global.o.source=value;$.fn.galleryFocus(global.o)},set:function(key,value){if(typeof%20global.o[key]!=%22undefined%22){global.o[key]=value;checkRefresh()}},get:function(key){if(typeof%20global.o[key]!=%22undefined%22){return%20global.o[key]}}};$.fn.galleryFocus=function(method){if(methods[method]){return%20methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof%20method===%22object%22||!method){return%20methods.init.apply(this,arguments)}else{$.error(%22Method%20%22+method+%22%20does%20not%20exist%20on%20jQuery.galleryFocus%22)}}}})(jQuery);jQuery('div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section,summary,time,mark,audio,video').galleryFocus({overlay:false,invert:true});}})();


if (typeof jQuery == 'undefined') {
	var jQ = document.createElement('script');
	jQ.type = 'text/javascript';
	jQ.onload=bookmarklet;
	jQ.src = 'http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js';
	document.body.appendChild(jQ);
} else {
	bookmarklet();
}

function bookmarklet() {
(function($){var global={o:{},e:[],source:{},overlay:null};var checkRefresh=function(){if(global.o.source=="cursor"){return false}$.fn.galleryFocus(global.o)};var calculatePosition=function(local){var p=local.el.offset();if(p.left==local.pos.left&&p.top==local.pos.top){return local.pos}var position={left:p.left,top:p.top,width:local.el.outerWidth(),height:local.el.outerHeight()};position.right=Math.floor(p.left+position.width);position.bottom=Math.floor(p.top+position.height);position.x=Math.floor(p.left+(position.width/2));position.y=Math.floor(p.top+(position.height/2));return position};var setFocus=function(elements){$.each(elements,function(i,el){if(typeof elements[i]=="undefined"){return true}elements[i].pos=calculatePosition(elements[i]);if(!testInBox(el)){if(global.o.invert){setOpacity(el,1)}else{setOpacity(el,global.o.fadeTo)}return true}el.pos=elements[i].pos;var length=distance(global.source,el.pos);var opacity=global.o.fadeTo;if(global.o.invert){opacity=toFloat(percentOf(length,global.o.radius))}else{opacity=toFloat(invertPercent(percentOf(length,global.o.radius)))}if(opacity<global.o.fadeTo){opacity=global.o.fadeTo}setOpacity(el,opacity)})};var createOverlay=function(){var style={position:"absolute",top:0,left:0,width:0,height:0,"z-index":999,"-moz-border-radius":"1000px","-webkit-border-radius":"1000px","-khtml-border-radius":"1000px","border-radius":"1000px",border:"2px solid rgba(80, 80, 80, 0.30)","pointer-events":"none"};$('<div id="gallery-focus-radius">').css(style).appendTo("body");global.overlay=$("#gallery-focus-radius")};var testInBox=function(el){var p=el.pos;if(p.left<global.source.left||p.top<global.source.top||p.right>global.source.right||p.bottom>global.source.bottom){return false}return true};var percentOf=function(a,b){return Math.floor((a/b)*100)};var toFloat=function(num){return(num/100)};var invertPercent=function(num){return(100-num)};var distance=function(p,q){var dx=p.x-q.x;var dy=p.y-q.y;var dist=Math.sqrt(dx*dx+dy*dy);return dist};var setOpacity=function(element,value){element.opacity=value;element.el.css("opacity",value)};var calculateMouse=function(e){global.source={x:e.pageX,y:e.pageY,left:e.pageX-global.o.radius,top:e.pageY-global.o.radius,right:e.pageX+global.o.radius,bottom:e.pageY+global.o.radius};if(global.o.overlay){if(global.overlay==null){createOverlay()}global.overlay.css({top:global.source.top,left:global.source.left,width:global.o.radius*2,height:global.o.radius*2})}};var setupSource=function(){var bindTo=$(global.o.source);if($(bindTo).length==1){$(document).unbind(".galleryFocus");var position=calculatePosition({el:bindTo,pos:{top:0,left:0}});calculateMouse({pageX:position.x,pageY:position.y});setFocus(global.e)}else{$(document).bind("mousemove.galleryFocus",function(c){calculateMouse(c);setFocus(global.e)})}};var methods={init:function(options){var defaults={radius:400,fadeTo:0.2,source:"cursor",invert:false,overlay:false};global.o=$.extend(defaults,options);this.each(function(i,el){global.e[i]={el:$(el),opacity:1,pos:{}};global.e[i].pos=calculatePosition(global.e[i])});setupSource();return this},overlay:function(value){global.o.overlay=value;if(value==false){global.overlay.hide()}else{if(global.overlay==null){calculateMouse(global.source)}checkRefresh();global.overlay.show()}},update:function(value){$.fn.galleryFocus(global.o)},source:function(value){global.o.source=value;$.fn.galleryFocus(global.o)},set:function(key,value){if(typeof global.o[key]!="undefined"){global.o[key]=value;checkRefresh()}},get:function(key){if(typeof global.o[key]!="undefined"){return global.o[key]}}};$.fn.galleryFocus=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.galleryFocus")}}}})(jQuery);
	
	jQuery('div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section,summary,time,mark,audio,video').galleryFocus({overlay: false, invert: true});
	
}
